{% extends "base.html" %}

{% block title %}Manage Teams & Classes{% endblock %}

{% block content %}
<div class="dashboard-header">
    <h2>Manage Classes & Teams</h2>
    <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">‚Üê Back to Dashboard</a>
</div>

<div class="card">
    <h3>Create New Class or Team</h3>
    <form method="POST" action="{{ url_for('create_team') }}">
        <div class="form-group">
            <label for="name">Name</label>
            <input type="text" id="name" name="name" required>
            <small style="color: var(--text-secondary);">Enter class name (e.g., "Intermediate Skiers") or team name (e.g., "Advanced Snow Stars")</small>
        </div>
        <div class="form-group">
            <label for="program_id">Program</label>
            <select id="program_id" name="program_id" required onchange="updateTypeLabel()">
                <option value="">Select Program</option>
                {% for program in programs %}
                <option value="{{ program.id }}">{{ program.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="coach_id">Coach</label>
            <select id="coach_id" name="coach_id" required>
                <option value="">Select Coach</option>
                {% for coach in coaches %}
                <option value="{{ coach.id }}">{{ coach.full_name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="club_id">Club</label>
            <select id="club_id" name="club_id">
                <option value="">Unassigned</option>
                {% for club in clubs %}
                <option value="{{ club.id }}">{{ club.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group" id="type-group">
            <label for="team_type">Type</label>
            <select id="team_type" name="team_type" required>
                <option value="class">Class</option>
                <option value="team">Team</option>
            </select>
        </div>
        <button type="submit" class="btn btn-primary" id="submit-btn">Create Class</button>
    </form>
</div>

<div class="card">
    <h3>Existing Classes & Teams</h3>
    {% if teams %}
    <table class="data-table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Type</th>
                <th>Program</th>
                <th>Coach</th>
                <th>Students</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for team in teams %}
            <tr>
                <td>
                    <strong>{{ team.name }}</strong>
                    <div id="edit-form-{{ team.id }}" style="display: none; margin-top: 1rem; padding: 1rem; background: var(--bg-light); border-radius: var(--radius);">
                        <form method="POST" action="{{ url_for('update_team', team_id=team.id) }}">
                            <div class="form-group">
                                <label for="name-{{ team.id }}">Name</label>
                                <input type="text" id="name-{{ team.id }}" name="name" value="{{ team.name }}" required>
                            </div>
                            <div class="form-group">
                                <label for="program_id-{{ team.id }}">Program</label>
                                <select id="program_id-{{ team.id }}" name="program_id" required>
                                    {% for prog in programs %}
                                    <option value="{{ prog.id }}" {% if prog.id == team.program_id %}selected{% endif %}>{{ prog.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="coach_id-{{ team.id }}">Coach</label>
                                <select id="coach_id-{{ team.id }}" name="coach_id" required>
                                    {% for c in coaches %}
                                    <option value="{{ c.id }}" {% if c.id == team.coach_id %}selected{% endif %}>{{ c.full_name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="club_id-{{ team.id }}">Club</label>
                                <select id="club_id-{{ team.id }}" name="club_id">
                                    <option value="">Unassigned</option>
                                    {% for c in clubs %}
                                    <option value="{{ c.id }}" {% if team.club_id == c.id %}selected{% endif %}>{{ c.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="team_type-{{ team.id }}">Type</label>
                                <select id="team_type-{{ team.id }}" name="team_type" required>
                                    <option value="class" {% if team.team_type == 'class' %}selected{% endif %}>Class</option>
                                    <option value="team" {% if team.team_type == 'team' %}selected{% endif %}>Team</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-sm btn-primary">Save</button>
                            <button type="button" onclick="toggleEdit({{ team.id }})" class="btn btn-sm btn-secondary">Cancel</button>
                        </form>
                    </div>
                </td>
                <td><span class="badge badge-{{ team.team_type }}">{{ team.team_type }}</span></td>
                <td>{{ team.program.name }}</td>
                <td>{{ team.coach.full_name }}</td>
                <td>{{ team.students|length }}</td>
                <td>
                    <button onclick="toggleEdit({{ team.id }})" class="btn btn-sm btn-secondary">Edit</button>
                    {% if team.students|length == 0 %}
                    <form method="POST" action="{{ url_for('delete_team', team_id=team.id) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this {{ team.team_type }}?');">
                        <button type="submit" class="btn btn-sm" style="background: var(--error-color); color: white; margin-top: 0.25rem;">Delete</button>
                    </form>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No teams yet. Create one above.</p>
    {% endif %}
</div>

<script>
function toggleEdit(teamId) {
    const form = document.getElementById('edit-form-' + teamId);
    form.style.display = form.style.display === 'none' ? 'block' : 'none';
}

function updateTypeLabel() {
    const programSelect = document.getElementById('program_id');
    const typeSelect = document.getElementById('team_type');
    const submitBtn = document.getElementById('submit-btn');
    
    const selectedProgram = programSelect.options[programSelect.selectedIndex].text;
    
    if (selectedProgram === 'Terrain Park' || selectedProgram === 'LIT') {
        typeSelect.value = 'team';
        submitBtn.textContent = 'Create Team';
    } else if (selectedProgram) {
        typeSelect.value = 'class';
        submitBtn.textContent = 'Create Class';
    }
}
</script>
{% endblock %}



