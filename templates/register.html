{% extends "base.html" %}

{% block title %}Register New User{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="auth-card">
        <h2>Add Coach or Admin</h2>
        <form method="POST" action="{{ url_for('register') }}">
            <div class="form-group">
                <label for="club_id">Club</label>
                <select id="club_id" name="club_id">
                    <option value="">Unassigned</option>
                    {% for club in clubs %}
                    <option value="{{ club.id }}">{{ club.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" name="username" required>
            </div>
            <div class="form-group">
                <label for="full_name">Full Name</label>
                <input type="text" id="full_name" name="full_name" required>
            </div>
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" name="email" required>
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" name="password" required>
            </div>
            <div class="form-group">
                <label for="user_type">User Type</label>
                <select id="user_type" name="user_type" required onchange="toggleStudentFields()">
                    <option value="admin">Admin</option>
                    <option value="coach">Coach</option>
                </select>
            </div>
            <input type="hidden" id="coach_id" name="coach_id" value="">
            <div class="form-group" id="team_group" style="display: none;">
                <!-- Hidden for admin/coach creation -->
                <label for="team_id">Assign to Team</label>
                <select id="team_id" name="team_id" onchange="updateCoachFromTeam()">
                    <option value="">Select Team</option>
                    {% for team in teams %}
                    <option value="{{ team.id }}" data-coach="{{ team.coach_id }}">
                        {{ team.name }} ({{ team.program.name }}) - {{ team.coach.full_name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group" id="sport_group" style="display: none;">
                <!-- Hidden for admin/coach creation -->
            </div>
            <button type="submit" class="btn btn-primary btn-block">Create User</button>
            <a href="{{ url_for('dashboard') }}" class="btn btn-secondary btn-block">Cancel</a>
        </form>
    </div>
</div>

<script>
function toggleStudentFields() {
    // Only admin/coach options available, so hide athlete fields
    const teamGroup = document.getElementById('team_group');
    const sportGroup = document.getElementById('sport_group');
    teamGroup.style.display = 'none';
    sportGroup.style.display = 'none';
}

function updateCoachFromTeam() {
    const teamSelect = document.getElementById('team_id');
    const coachInput = document.getElementById('coach_id');
    const selectedOption = teamSelect.options[teamSelect.selectedIndex];
    
    if (selectedOption.value) {
        coachInput.value = selectedOption.getAttribute('data-coach');
    } else {
        coachInput.value = '';
    }
}
</script>
{% endblock %}
